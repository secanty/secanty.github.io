{"version":3,"file":"../../js/imgloaded.js","names":["ProgressiveLoad","constructor","smallSrc","largeSrc","this","initTpl","container","addEventListener","smallStage","style","display","once","document","createElement","largeStage","smallImg","Image","largeImg","className","appendChild","onload","_onSmallLoaded","bind","_onLargeLoaded","progressiveLoad","src","classList","add","backgroundImage","executeLoad","config","target","isMobile","window","matchMedia","matches","loader","mobileSmallSrc","mobileLargeSrc","children","insertBefore","ldconfig","light","enableRoutes","dark","getCurrentTheme","documentElement","getAttribute","onThemeChange","currentTheme","initProgressiveLoad","getElementById","contains","onPJAXComplete","initTheme","querySelector","remove","MutationObserver","mutations","forEach","mutation","attributeName","location","pathname","observe","attributes","attributeFilter"],"sources":["js/imgloaded.js"],"mappings":"CAIA,WACI,MAAMA,EACF,WAAAC,CAAYC,EAAUC,GAClBC,KAAKF,SAAWA,EAChBE,KAAKD,SAAWA,EAChBC,KAAKC,UACLD,KAAKE,UAAUC,iBAAiB,gBAAgB,KAC5CH,KAAKI,WAAWC,MAAMC,QAAU,MAAM,GACvC,CAACC,MAAM,GACd,CAEA,OAAAN,GACID,KAAKE,UAAYM,SAASC,cAAc,OACxCT,KAAKI,WAAaI,SAASC,cAAc,OACzCT,KAAKU,WAAaF,SAASC,cAAc,OACzCT,KAAKW,SAAW,IAAIC,MACpBZ,KAAKa,SAAW,IAAID,MACpBZ,KAAKE,UAAUY,UAAY,eAC3Bd,KAAKI,WAAWU,UAAY,iBAC5Bd,KAAKU,WAAWI,UAAY,SAC5Bd,KAAKE,UAAUa,YAAYf,KAAKI,YAChCJ,KAAKE,UAAUa,YAAYf,KAAKU,YAChCV,KAAKW,SAASK,OAAShB,KAAKiB,eAAeC,KAAKlB,MAChDA,KAAKa,SAASG,OAAShB,KAAKmB,eAAeD,KAAKlB,KACpD,CAEA,eAAAoB,GACIpB,KAAKW,SAASU,IAAMrB,KAAKF,SACzBE,KAAKa,SAASQ,IAAMrB,KAAKD,QAC7B,CAEA,cAAAoB,GACInB,KAAKU,WAAWY,UAAUC,IAAI,cAC9BvB,KAAKU,WAAWL,MAAMmB,gBAAkB,QAAQxB,KAAKD,YACzD,CAEA,cAAAkB,GACIjB,KAAKI,WAAWkB,UAAUC,IAAI,cAC9BvB,KAAKI,WAAWC,MAAMmB,gBAAkB,QAAQxB,KAAKF,YACzD,EAGJ,MAAM2B,EAAc,CAACC,EAAQC,KAEzB,MAAMC,EAAWC,OAAOC,WAAW,sBAAsBC,QACnDC,EAAS,IAAIpC,EACfgC,EAAWF,EAAOO,eAAiBP,EAAO5B,SAC1C8B,EAAWF,EAAOQ,eAAiBR,EAAO3B,UAE1C4B,EAAOQ,SAAS,IAChBR,EAAOS,aAAaJ,EAAO9B,UAAWyB,EAAOQ,SAAS,IAE1DH,EAAOZ,iBAAiB,EAGtBiB,EAAW,CACbC,MAAO,CACHxC,SAAU,qBACVC,SAAU,qBACVkC,eAAgB,qBAChBC,eAAgB,qBAChBK,aAAc,CAAC,MAEnBC,KAAM,CACF1C,SAAU,oBACVC,SAAU,oBACVkC,eAAgB,oBAChBC,eAAgB,oBAChBK,aAAc,CAAC,OAIjBE,EAAkB,IACbjC,SAASkC,gBAAgBC,aAAa,cAG3CC,EAAgB,KAClB,MAAMC,EAAeJ,IACff,EAASW,EAASQ,GACxBC,EAAoBpB,GACpBlB,SAASL,iBAAiB,oBAAoB,WAC1C2C,EAAoBpB,EACxB,IAEAlB,SAASL,iBAAiB,iBAAiB,YAiC/C,SAAwBuB,GACpB,MAAMC,EAASnB,SAASuC,eAAe,eACnCpB,GAAUA,EAAOL,UAAU0B,SAAS,cACpCF,EAAoBpB,EAE5B,CArCQuB,CAAevB,EACnB,GAAE,EAGN,IAAIwB,EAAYT,IAEhBK,EADiBT,EAASa,IAgB1B,SAASJ,EAAoBpB,GACzB,MAAMxB,EAAYM,SAAS2C,cAAc,iBACrCjD,GACAA,EAAUkD,SAEd,MAAMzB,EAASnB,SAASuC,eAAe,eACnCpB,GAAUA,EAAOL,UAAU0B,SAAS,cACpCvB,EAAYC,EAAQC,EAE5B,CAtBiB,IAAI0B,kBAAiBC,IAClCA,EAAUC,SAAQC,IACiB,eAA3BA,EAASC,eAAwD,MAAtBC,SAASC,UACpDf,GACJ,GACF,IAGGgB,QAAQpD,SAASkC,gBAAiB,CACvCmB,YAAY,EACZC,gBAAiB,CAAC,eAqBzB,CA5HD","ignoreList":[],"sourcesContent":["// 首页一图流加载优化\n/**\n * @description 实现medium的渐进加载背景的效果\n */\n(function() {\n    class ProgressiveLoad {\n        constructor(smallSrc, largeSrc) {\n            this.smallSrc = smallSrc;\n            this.largeSrc = largeSrc;\n            this.initTpl();\n            this.container.addEventListener('animationend', () => {\n                this.smallStage.style.display = 'none';\n            }, {once: true});\n        }\n\n        initTpl() {\n            this.container = document.createElement('div');\n            this.smallStage = document.createElement('div');\n            this.largeStage = document.createElement('div');\n            this.smallImg = new Image();\n            this.largeImg = new Image();\n            this.container.className = 'pl-container';\n            this.smallStage.className = 'pl-img pl-blur';\n            this.largeStage.className = 'pl-img';\n            this.container.appendChild(this.smallStage);\n            this.container.appendChild(this.largeStage);\n            this.smallImg.onload = this._onSmallLoaded.bind(this);\n            this.largeImg.onload = this._onLargeLoaded.bind(this);\n        }\n\n        progressiveLoad() {\n            this.smallImg.src = this.smallSrc;\n            this.largeImg.src = this.largeSrc;\n        }\n\n        _onLargeLoaded() {\n            this.largeStage.classList.add('pl-visible');\n            this.largeStage.style.backgroundImage = `url('${this.largeSrc}')`;\n        }\n\n        _onSmallLoaded() {\n            this.smallStage.classList.add('pl-visible');\n            this.smallStage.style.backgroundImage = `url('${this.smallSrc}')`;\n        }\n    }\n\n    const executeLoad = (config, target) => {\n        // console.log('执行渐进背景替换');\n        const isMobile = window.matchMedia('(max-width: 767px)').matches;\n        const loader = new ProgressiveLoad(\n            isMobile ? config.mobileSmallSrc : config.smallSrc,\n            isMobile ? config.mobileLargeSrc : config.largeSrc\n        );\n        if (target.children[0]) {\n            target.insertBefore(loader.container, target.children[0]);\n        }\n        loader.progressiveLoad();\n    };\n\n    const ldconfig = {\n        light: {\n            smallSrc: '/img/light_bg0.jpg', //浅色模式 小图链接 尽可能配置小于100k的图片\n            largeSrc: '/img/light_bg1.jpg', //浅色模式 大图链接 最终显示的图片\n            mobileSmallSrc: '/img/light_bg0.jpg', //手机端浅色小图链接 尽可能配置小于100k的图片\n            mobileLargeSrc: '/img/light_bg1.jpg', //手机端浅色大图链接 最终显示的图片\n            enableRoutes: ['/'],\n        },\n        dark: {\n            smallSrc: '/img/dark_bg0.jpg', //深色模式 小图链接 尽可能配置小于100k的图片\n            largeSrc: '/img/dark_bg1.jpg', //深色模式 大图链接 最终显示的图片\n            mobileSmallSrc: '/img/dark_bg0.jpg', //手机端深色模式小图链接 尽可能配置小于100k的图片\n            mobileLargeSrc: '/img/dark_bg1.jpg', //手机端深色大图链接 最终显示的图片\n            enableRoutes: ['/'],\n        },\n    };\n\n    const getCurrentTheme = () => {\n        return document.documentElement.getAttribute('data-theme');\n    }\n\n    const onThemeChange = () => {\n        const currentTheme = getCurrentTheme();\n        const config = ldconfig[currentTheme];\n        initProgressiveLoad(config);\n        document.addEventListener(\"DOMContentLoaded\", function() {\n            initProgressiveLoad(config);\n        });\n\n        document.addEventListener(\"pjax:complete\", function() {\n            onPJAXComplete(config);\n        });\n    }\n\n    let initTheme = getCurrentTheme();\n    let initConfig = ldconfig[initTheme];\n    initProgressiveLoad(initConfig);\n\n    const observer = new MutationObserver(mutations => {\n        mutations.forEach(mutation => {\n            if (mutation.attributeName === \"data-theme\" && location.pathname === '/') {\n                onThemeChange();\n            }\n        });\n    });\n\n    observer.observe(document.documentElement, {\n        attributes: true,\n        attributeFilter: [\"data-theme\"]\n    });\n\n    function initProgressiveLoad(config) {\n        const container = document.querySelector('.pl-container');\n        if (container) {\n            container.remove();\n        }\n        const target = document.getElementById('page-header');\n        if (target && target.classList.contains('full_page')) {\n            executeLoad(config, target);\n        }\n    }\n\n    function onPJAXComplete(config) {\n        const target = document.getElementById('page-header');\n        if (target && target.classList.contains('full_page')) {\n            initProgressiveLoad(config);\n        }\n    }\n\n})();\n"]}