{"version":3,"file":"../../js/fish.js","names":["RENDERER","POINT_INTERVAL","FISH_COUNT","MAX_INTERVAL_COUNT","INIT_HEIGHT_RATE","THRESHOLD","init","this","setParameters","reconstructMethods","setup","bindEvent","render","$window","$","window","$container","$canvas","context","appendTo","get","getContext","points","fishes","watchIds","createSurfacePoints","count","Math","round","width","pointInterval","push","SURFACE_POINT","i","point","previous","setPreviousPoint","setNextPoint","watchWindowSize","bind","jdugeToStopResize","startEpicenter","moveEpicenter","reverseVertical","length","intervalCount","height","fishCount","attr","reverse","FISH","clearTimer","tmpWidth","tmpHeight","setTimeout","WATCH_INTERVAL","clearTimeout","pop","stopped","on","getAxis","event","offset","x","clientX","left","scrollLeft","y","clientY","top","scrollTop","axis","generateEpicenter","velocity","index","interfere","controlStatus","updateSelf","updateNeighbors","requestAnimationFrame","clearRect","fillStyle","save","globalCompositeOperation","beginPath","moveTo","lineTo","closePath","fill","restore","renderer","prototype","SPRING_CONSTANT","SPRING_FRICTION","WAVE_SPREAD","ACCELARATION_RATE","initHeight","fy","force","next","abs","GRAVITY","direction","random","previousY","vx","getRandomValue","vy","ay","isOut","theta","phi","min","max","PI","translate","rotate","atan2","scale","bezierCurveTo","sin","quadraticCurveTo"],"sources":["js/fish.js"],"mappings":"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","ignoreList":[],"sourcesContent":["var RENDERER = {\n\tPOINT_INTERVAL : 5,\n\tFISH_COUNT : 3,\n\tMAX_INTERVAL_COUNT : 50,\n\tINIT_HEIGHT_RATE : 0.5,\n\tTHRESHOLD : 50,\n\n\tinit : function(){\n\t\tthis.setParameters();\n\t\tthis.reconstructMethods();\n\t\tthis.setup();\n\t\tthis.bindEvent();\n\t\tthis.render();\n\t},\n\tsetParameters : function(){\n\t\tthis.$window = $(window);\n\t\tthis.$container = $('#jsi-flying-fish-container');\n\t\tthis.$canvas = $('<canvas />');\n\t\tthis.context = this.$canvas.appendTo(this.$container).get(0).getContext('2d');\n\t\tthis.points = [];\n\t\tthis.fishes = [];\n\t\tthis.watchIds = [];\n\t},\n\tcreateSurfacePoints : function(){\n\t\tvar count = Math.round(this.width / this.POINT_INTERVAL);\n\t\tthis.pointInterval = this.width / (count - 1);\n\t\tthis.points.push(new SURFACE_POINT(this, 0));\n\n\t\tfor(var i = 1; i < count; i++){\n\t\t\tvar point = new SURFACE_POINT(this, i * this.pointInterval),\n\t\t\t\tprevious = this.points[i - 1];\n\n\t\t\tpoint.setPreviousPoint(previous);\n\t\t\tprevious.setNextPoint(point);\n\t\t\tthis.points.push(point);\n\t\t}\n\t},\n\treconstructMethods : function(){\n\t\tthis.watchWindowSize = this.watchWindowSize.bind(this);\n\t\tthis.jdugeToStopResize = this.jdugeToStopResize.bind(this);\n\t\tthis.startEpicenter = this.startEpicenter.bind(this);\n\t\tthis.moveEpicenter = this.moveEpicenter.bind(this);\n\t\tthis.reverseVertical = this.reverseVertical.bind(this);\n\t\tthis.render = this.render.bind(this);\n\t},\n\tsetup : function(){\n\t\tthis.points.length = 0;\n\t\tthis.fishes.length = 0;\n\t\tthis.watchIds.length = 0;\n\t\tthis.intervalCount = this.MAX_INTERVAL_COUNT;\n\t\tthis.width = this.$container.width();\n\t\tthis.height = this.$container.height();\n\t\tthis.fishCount = this.FISH_COUNT * this.width / 500 * this.height / 500;\n\t\tthis.$canvas.attr({width : this.width, height : this.height});\n\t\tthis.reverse = false;\n\n\t\tthis.fishes.push(new FISH(this));\n\t\tthis.createSurfacePoints();\n\t},\n\twatchWindowSize : function(){\n\t\tthis.clearTimer();\n\t\tthis.tmpWidth = this.$window.width();\n\t\tthis.tmpHeight = this.$window.height();\n\t\tthis.watchIds.push(setTimeout(this.jdugeToStopResize, this.WATCH_INTERVAL));\n\t},\n\tclearTimer : function(){\n\t\twhile(this.watchIds.length > 0){\n\t\t\tclearTimeout(this.watchIds.pop());\n\t\t}\n\t},\n\tjdugeToStopResize : function(){\n\t\tvar width = this.$window.width(),\n\t\t\theight = this.$window.height(),\n\t\t\tstopped = (width == this.tmpWidth && height == this.tmpHeight);\n\n\t\tthis.tmpWidth = width;\n\t\tthis.tmpHeight = height;\n\n\t\tif(stopped){\n\t\t\tthis.setup();\n\t\t}\n\t},\n\tbindEvent : function(){\n\t\tthis.$window.on('resize', this.watchWindowSize);\n\t\tthis.$container.on('mouseenter', this.startEpicenter);\n\t\tthis.$container.on('mousemove', this.moveEpicenter);\n\t\t// this.$container.on('click', this.reverseVertical);\n\t},\n\tgetAxis : function(event){\n\t\tvar offset = this.$container.offset();\n\n\t\treturn {\n\t\t\tx : event.clientX - offset.left + this.$window.scrollLeft(),\n\t\t\ty : event.clientY - offset.top + this.$window.scrollTop()\n\t\t};\n\t},\n\tstartEpicenter : function(event){\n\t\tthis.axis = this.getAxis(event);\n\t},\n\tmoveEpicenter : function(event){\n\t\tvar axis = this.getAxis(event);\n\n\t\tif(!this.axis){\n\t\t\tthis.axis = axis;\n\t\t}\n\t\tthis.generateEpicenter(axis.x, axis.y, axis.y - this.axis.y);\n\t\tthis.axis = axis;\n\t},\n\tgenerateEpicenter : function(x, y, velocity){\n\t\tif(y < this.height / 2 - this.THRESHOLD || y > this.height / 2 + this.THRESHOLD){\n\t\t\treturn;\n\t\t}\n\t\tvar index = Math.round(x / this.pointInterval);\n\n\t\tif(index < 0 || index >= this.points.length){\n\t\t\treturn;\n\t\t}\n\t\tthis.points[index].interfere(y, velocity);\n\t},\n\treverseVertical : function(){\n\t\tthis.reverse = !this.reverse;\n\n\t\tfor(var i = 0, count = this.fishes.length; i < count; i++){\n\t\t\tthis.fishes[i].reverseVertical();\n\t\t}\n\t},\n\tcontrolStatus : function(){\n\t\tfor(var i = 0, count = this.points.length; i < count; i++){\n\t\t\tthis.points[i].updateSelf();\n\t\t}\n\t\tfor(var i = 0, count = this.points.length; i < count; i++){\n\t\t\tthis.points[i].updateNeighbors();\n\t\t}\n\t\tif(this.fishes.length < this.fishCount){\n\t\t\tif(--this.intervalCount == 0){\n\t\t\t\tthis.intervalCount = this.MAX_INTERVAL_COUNT;\n\t\t\t\tthis.fishes.push(new FISH(this));\n\t\t\t}\n\t\t}\n\t},\n\trender : function(){\n\t\trequestAnimationFrame(this.render);\n\t\tthis.controlStatus();\n\t\tthis.context.clearRect(0, 0, this.width, this.height);\n\t\tthis.context.fillStyle = 'hsl(0, 0%, 95%)';\n\n\t\tfor(var i = 0, count = this.fishes.length; i < count; i++){\n\t\t\tthis.fishes[i].render(this.context);\n\t\t}\n\t\tthis.context.save();\n\t\tthis.context.globalCompositeOperation = 'xor';\n\t\tthis.context.beginPath();\n\t\tthis.context.moveTo(0, this.reverse ? 0 : this.height);\n\n\t\tfor(var i = 0, count = this.points.length; i < count; i++){\n\t\t\tthis.points[i].render(this.context);\n\t\t}\n\t\tthis.context.lineTo(this.width, this.reverse ? 0 : this.height);\n\t\tthis.context.closePath();\n\t\tthis.context.fill();\n\t\tthis.context.restore();\n\t}\n};\nvar SURFACE_POINT = function(renderer, x){\n\tthis.renderer = renderer;\n\tthis.x = x;\n\tthis.init();\n};\nSURFACE_POINT.prototype = {\n\tSPRING_CONSTANT : 0.03,\n\tSPRING_FRICTION : 0.9,\n\tWAVE_SPREAD : 0.3,\n\tACCELARATION_RATE : 0.01,\n\n\tinit : function(){\n\t\tthis.initHeight = this.renderer.height * this.renderer.INIT_HEIGHT_RATE;\n\t\tthis.height = this.initHeight;\n\t\tthis.fy = 0;\n\t\tthis.force = {previous : 0, next : 0};\n\t},\n\tsetPreviousPoint : function(previous){\n\t\tthis.previous = previous;\n\t},\n\tsetNextPoint : function(next){\n\t\tthis.next = next;\n\t},\n\tinterfere : function(y, velocity){\n\t\tthis.fy = this.renderer.height * this.ACCELARATION_RATE * ((this.renderer.height - this.height - y) >= 0 ? -1 : 1) * Math.abs(velocity);\n\t},\n\tupdateSelf : function(){\n\t\tthis.fy += this.SPRING_CONSTANT * (this.initHeight - this.height);\n\t\tthis.fy *= this.SPRING_FRICTION;\n\t\tthis.height += this.fy;\n\t},\n\tupdateNeighbors : function(){\n\t\tif(this.previous){\n\t\t\tthis.force.previous = this.WAVE_SPREAD * (this.height - this.previous.height);\n\t\t}\n\t\tif(this.next){\n\t\t\tthis.force.next = this.WAVE_SPREAD * (this.height - this.next.height);\n\t\t}\n\t},\n\trender : function(context){\n\t\tif(this.previous){\n\t\t\tthis.previous.height += this.force.previous;\n\t\t\tthis.previous.fy += this.force.previous;\n\t\t}\n\t\tif(this.next){\n\t\t\tthis.next.height += this.force.next;\n\t\t\tthis.next.fy += this.force.next;\n\t\t}\n\t\tcontext.lineTo(this.x, this.renderer.height - this.height);\n\t}\n};\nvar FISH = function(renderer){\n\tthis.renderer = renderer;\n\tthis.init();\n};\nFISH.prototype = {\n\tGRAVITY : 0.4,\n\n\tinit : function(){\n\t\tthis.direction = Math.random() < 0.5;\n\t\tthis.x = this.direction ? (this.renderer.width + this.renderer.THRESHOLD) : -this.renderer.THRESHOLD;\n\t\tthis.previousY = this.y;\n\t\tthis.vx = this.getRandomValue(4, 10) * (this.direction ? -1 : 1);\n\n\t\tif(this.renderer.reverse){\n\t\t\tthis.y = this.getRandomValue(this.renderer.height * 1 / 10, this.renderer.height * 4 / 10);\n\t\t\tthis.vy = this.getRandomValue(2, 5);\n\t\t\tthis.ay = this.getRandomValue(0.05, 0.2);\n\t\t}else{\n\t\t\tthis.y = this.getRandomValue(this.renderer.height * 6 / 10, this.renderer.height * 9 / 10);\n\t\t\tthis.vy = this.getRandomValue(-5, -2);\n\t\t\tthis.ay = this.getRandomValue(-0.2, -0.05);\n\t\t}\n\t\tthis.isOut = false;\n\t\tthis.theta = 0;\n\t\tthis.phi = 0;\n\t},\n\tgetRandomValue : function(min, max){\n\t\treturn min + (max - min) * Math.random();\n\t},\n\treverseVertical : function(){\n\t\tthis.isOut = !this.isOut;\n\t\tthis.ay *= -1;\n\t},\n\tcontrolStatus : function(context){\n\t\tthis.previousY = this.y;\n\t\tthis.x += this.vx;\n\t\tthis.y += this.vy;\n\t\tthis.vy += this.ay;\n\n\t\tif(this.renderer.reverse){\n\t\t\tif(this.y > this.renderer.height * this.renderer.INIT_HEIGHT_RATE){\n\t\t\t\tthis.vy -= this.GRAVITY;\n\t\t\t\tthis.isOut = true;\n\t\t\t}else{\n\t\t\t\tif(this.isOut){\n\t\t\t\t\tthis.ay = this.getRandomValue(0.05, 0.2);\n\t\t\t\t}\n\t\t\t\tthis.isOut = false;\n\t\t\t}\n\t\t}else{\n\t\t\tif(this.y < this.renderer.height * this.renderer.INIT_HEIGHT_RATE){\n\t\t\t\tthis.vy += this.GRAVITY;\n\t\t\t\tthis.isOut = true;\n\t\t\t}else{\n\t\t\t\tif(this.isOut){\n\t\t\t\t\tthis.ay = this.getRandomValue(-0.2, -0.05);\n\t\t\t\t}\n\t\t\t\tthis.isOut = false;\n\t\t\t}\n\t\t}\n\t\tif(!this.isOut){\n\t\t\tthis.theta += Math.PI / 20;\n\t\t\tthis.theta %= Math.PI * 2;\n\t\t\tthis.phi += Math.PI / 30;\n\t\t\tthis.phi %= Math.PI * 2;\n\t\t}\n\t\tthis.renderer.generateEpicenter(this.x + (this.direction ? -1 : 1) * this.renderer.THRESHOLD, this.y, this.y - this.previousY);\n\n\t\tif(this.vx > 0 && this.x > this.renderer.width + this.renderer.THRESHOLD || this.vx < 0 && this.x < -this.renderer.THRESHOLD){\n\t\t\tthis.init();\n\t\t}\n\t},\n\trender : function(context){\n\t\tcontext.save();\n\t\tcontext.translate(this.x, this.y);\n\t\tcontext.rotate(Math.PI + Math.atan2(this.vy, this.vx));\n\t\tcontext.scale(1, this.direction ? 1 : -1);\n\t\tcontext.beginPath();\n\t\tcontext.moveTo(-30, 0);\n\t\tcontext.bezierCurveTo(-20, 15, 15, 10, 40, 0);\n\t\tcontext.bezierCurveTo(15, -10, -20, -15, -30, 0);\n\t\tcontext.fill();\n\n\t\tcontext.save();\n\t\tcontext.translate(40, 0);\n\t\tcontext.scale(0.9 + 0.2 * Math.sin(this.theta), 1);\n\t\tcontext.beginPath();\n\t\tcontext.moveTo(0, 0);\n\t\tcontext.quadraticCurveTo(5, 10, 20, 8);\n\t\tcontext.quadraticCurveTo(12, 5, 10, 0);\n\t\tcontext.quadraticCurveTo(12, -5, 20, -8);\n\t\tcontext.quadraticCurveTo(5, -10, 0, 0);\n\t\tcontext.fill();\n\t\tcontext.restore();\n\n\t\tcontext.save();\n\t\tcontext.translate(-3, 0);\n\t\tcontext.rotate((Math.PI / 3 + Math.PI / 10 * Math.sin(this.phi)) * (this.renderer.reverse ? -1 : 1));\n\n\t\tcontext.beginPath();\n\n\t\tif(this.renderer.reverse){\n\t\t\tcontext.moveTo(5, 0);\n\t\t\tcontext.bezierCurveTo(10, 10, 10, 30, 0, 40);\n\t\t\tcontext.bezierCurveTo(-12, 25, -8, 10, 0, 0);\n\t\t}else{\n\t\t\tcontext.moveTo(-5, 0);\n\t\t\tcontext.bezierCurveTo(-10, -10, -10, -30, 0, -40);\n\t\t\tcontext.bezierCurveTo(12, -25, 8, -10, 0, 0);\n\t\t}\n\t\tcontext.closePath();\n\t\tcontext.fill();\n\t\tcontext.restore();\n\t\tcontext.restore();\n\t\tthis.controlStatus(context);\n\t}\n};\n$(function(){\n\tRENDERER.init();\n});"]}